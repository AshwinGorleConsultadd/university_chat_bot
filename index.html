<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Assistant</title>
    <script type="importmap">
    {
        "imports": {
            "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        .banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(16, 16, 17, 0.294);
            background-blend-mode: color;
            z-index: 0;
        }

        .banner-content {
            position: relative;
            z-index: 1;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-placeholder {
            font-size: 32px;
            color: #667eea;
            font-weight: bold;
        }

        .banner h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .banner p {
            font-size: 14px;
            opacity: 0.95;
        }

        .config-section {
            background: #f8f9fc;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e4e8;
        }

        .config-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .config-row input[type="text"],
        .config-row input[type="file"] {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
            background: white;
        }

        .config-row button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .config-row button:hover {
            background: #5568d3;
        }

        .file-label {
            font-size: 12px;
            color: #6b7280;
            margin-right: 8px;
            min-width: 120px;
        }

        .status-text {
            font-size: 11px;
            color: #059669;
            margin-left: 10px;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 30px;
            background: #fafbfc;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.5;
            font-size: 14px;
        }

        .message.bot .message-content {
            background: white;
            color: #1f2937;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
        }

        .message.system .message-content {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
            max-width: 100%;
            text-align: center;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            width: fit-content;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .input-section {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #userInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #sendBtn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        #sendBtn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .welcome-message h2 {
            font-size: 20px;
            color: #374151;
            margin-bottom: 10px;
        }

        .welcome-message p {
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }

            .message-content {
                max-width: 85%;
            }

            .config-row {
                flex-direction: column;
            }

            .file-label {
                min-width: auto;
            }
        }

        .message.bot .message-content {
    background: white;
    color: #1f2937;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* ADD THESE STYLES BELOW */
.message.bot .message-content h1,
.message.bot .message-content h2,
.message.bot .message-content h3 {
    margin-top: 12px;
    margin-bottom: 8px;
    font-weight: 600;
}

.message.bot .message-content h1 { font-size: 18px; }
.message.bot .message-content h2 { font-size: 16px; }
.message.bot .message-content h3 { font-size: 14px; }

.message.bot .message-content p {
    margin-bottom: 8px;
}

.message.bot .message-content ul,
.message.bot .message-content ol {
    margin: 8px 0;
    padding-left: 20px;
}

.message.bot .message-content li {
    margin: 4px 0;
}

.message.bot .message-content strong {
    font-weight: 600;
    color: #111827;
}

.message.bot .message-content em {
    font-style: italic;
}

.message.bot .message-content code {
    background: #f3f4f6;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
}

.message.bot .message-content pre {
    background: #f3f4f6;
    padding: 12px;
    border-radius: 6px;
    overflow-x: auto;
    margin: 8px 0;
}

.message.bot .message-content pre code {
    background: none;
    padding: 0;
}

.message.bot .message-content blockquote {
    border-left: 3px solid #667eea;
    padding-left: 12px;
    margin: 8px 0;
    color: #6b7280;
}

.message.bot .message-content a {
    color: #667eea;
    text-decoration: none;
}

.message.bot .message-content a:hover {
    text-decoration: underline;
}

.message.bot .message-content hr {
    border: none;
    border-top: 1px solid #e5e7eb;
    margin: 12px 0;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="banner">
            <div class="banner-content">
                <div class="logo-container">
                    <div class="logo-placeholder" id="logoPlaceholder">üéì</div>
                    <img id="logoImg" style="display: none;" alt="College Logo">
                </div>
                <h1>Pushpdeep InfoBot</h1>
                <p>Your guide to admissions, courses, and campus life.</p>
            </div>
        </div>

        <div class="config-section">
            <div style="text-align: center; padding: 10px; color: #6b7280; font-size: 13px;">
                <span id="loadingStatus">‚è≥ Loading university data...</span>
            </div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="welcome-message">
                <h2>üëã Welcome!</h2>
                <p>Please wait while we load the university information...</p>
            </div>
        </div>

        <div class="input-section">
            <div class="input-container">
                <input type="text" id="userInput" placeholder="Type your question here..." />
                <button id="sendBtn">
                    <span>Send</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // ========================================
        // CONFIGURATION - UPDATE THESE VALUES
        // ========================================
        const CONFIG = {
            GEMINI_API_KEY: 'AIzaSyAhcvo9_g775-2zo2Z3u-CzClwQ61cSP1I',
            KNOWLEDGE_BASE_URL: 'university_info.txt',
            UNIVERSITY_SUMMARY_URL: 'univercity_summary.txt',
            LOGO_URL: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnixa4JCSO7Attpj8QU7VK1tdywmPn0GMuZw&s',
            BANNER_IMAGE_URL: 'https://pgckhategaon.co.in/assets/images/slider/2.jpg'
        };
        // ========================================

        let genAI;
        let model;
        let knowledgeBase = '';
        let universitySummary = '';
        let conversationHistory = [];
        let isLoading = true;

        // Initialize on page load
        window.onload = async function() {
            // Initialize Gemini AI
            try {
                genAI = new GoogleGenerativeAI(CONFIG.GEMINI_API_KEY);
                model = genAI.getGenerativeModel({ 
                    model: "gemini-2.5-flash",
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 800,
                        topK: 40,
                        topP: 0.95,
                    }
                });
            } catch (error) {
                console.error('Error initializing Gemini:', error);
                document.getElementById('loadingStatus').innerHTML = '‚ùå Error initializing AI. Check API key.';
                return;
            }

            // Set logo
            if (CONFIG.LOGO_URL) {
                document.getElementById('logoImg').src = CONFIG.LOGO_URL;
                document.getElementById('logoImg').style.display = 'block';
                document.getElementById('logoPlaceholder').style.display = 'none';
            }

            // Set banner image
            if (CONFIG.BANNER_IMAGE_URL) {
                document.querySelector('.banner').style.backgroundImage = `url('${CONFIG.BANNER_IMAGE_URL}')`;
            }

            // Load knowledge base and summary
            try {
                await loadFiles();
                isLoading = false;
                document.getElementById('loadingStatus').innerHTML = "Curious about our college? I'm here for you!";
                document.querySelector('.welcome-message').innerHTML = '<h2> Ready to Chat!</h2><p>Let‚Äôs make your college search easier. What can I help you with?</p>';
            } catch (error) {
                isLoading = false;
                document.getElementById('loadingStatus').innerHTML = '‚ùå Error loading data. Please refresh the page.';
                console.error('Error loading files:', error);
            }

            // Setup event listeners
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('userInput').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });
        };

        async function loadFiles() {
            try {
                // Load knowledge base
                const kbResponse = await fetch(CONFIG.KNOWLEDGE_BASE_URL);
                if (!kbResponse.ok) throw new Error('Failed to load knowledge base');
                knowledgeBase = await kbResponse.text();

                // Load university summary
                const summaryResponse = await fetch(CONFIG.UNIVERSITY_SUMMARY_URL);
                if (!summaryResponse.ok) throw new Error('Failed to load university summary');
                universitySummary = await summaryResponse.text();
            } catch (error) {
                throw new Error('Failed to load configuration files: ' + error.message);
            }
        }

        // function addMessage(text, type) {
        //     const chatContainer = document.getElementById('chatContainer');
        //     const welcome = document.querySelector('.welcome-message');
        //     if (welcome) welcome.remove();

        //     const messageDiv = document.createElement('div');
        //     messageDiv.className = `message ${type}`;
            
        //     const contentDiv = document.createElement('div');
        //     contentDiv.className = 'message-content';
        //     contentDiv.textContent = text;
            
        //     messageDiv.appendChild(contentDiv);
        //     chatContainer.appendChild(messageDiv);
        //     chatContainer.scrollTop = chatContainer.scrollHeight;
        // }

        // ADD THIS NEW FUNCTION ANYWHERE IN YOUR JAVASCRIPT
function parseMarkdown(text) {
    // Escape HTML to prevent XSS
    let html = text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');

    // Code blocks (```)
    html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');

    // Inline code (`)
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

    // Bold (**text** or __text__)
    html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/__([^_]+)__/g, '<strong>$1</strong>');

    // Italic (*text* or _text_)
    html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
    html = html.replace(/_([^_]+)_/g, '<em>$1</em>');

    // Headers (# ## ###)
    html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
    html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
    html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');

    // Blockquotes (>)
    html = html.replace(/^&gt; (.*$)/gm, '<blockquote>$1</blockquote>');

    // Horizontal rule (---)
    html = html.replace(/^---$/gm, '<hr>');

    // Links [text](url)
    html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

    // Unordered lists (- or *)
    html = html.replace(/^\s*[-*] (.+)$/gm, '<li>$1</li>');
    html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
  

    // Ordered lists (1. 2. 3.)
    html = html.replace(/^\s*\d+\.\s+(.+)$/gm, '<li>$1</li>');
    html = html.replace(/(<li>.*<\/li>)/s, function(match) {
        if (!match.includes('<ul>')) {
            return '<ol>' + match + '</ol>';
        }
        return match;
    });

    // Line breaks
    html = html.replace(/\n\n/g, '</p><p>');
    html = '<p>' + html + '</p>';

    // Clean up empty paragraphs
    html = html.replace(/<p><\/p>/g, '');
    html = html.replace(/<p>(<h[1-3]>)/g, '$1');
    html = html.replace(/(<\/h[1-3]>)<\/p>/g, '$1');
    html = html.replace(/<p>(<ul>)/g, '$1');
    html = html.replace(/(<\/ul>)<\/p>/g, '$1');
    html = html.replace(/<p>(<ol>)/g, '$1');
    html = html.replace(/(<\/ol>)<\/p>/g, '$1');
    html = html.replace(/<p>(<pre>)/g, '$1');
    html = html.replace(/(<\/pre>)<\/p>/g, '$1');
    html = html.replace(/<p>(<blockquote>)/g, '$1');
    html = html.replace(/(<\/blockquote>)<\/p>/g, '$1');
    html = html.replace(/<p>(<hr>)<\/p>/g, '$1');

    return html;
}

        // REPLACE YOUR EXISTING addMessage FUNCTION WITH THIS:
function addMessage(text, type) {
    const chatContainer = document.getElementById('chatContainer');
    const welcome = document.querySelector('.welcome-message');
    if (welcome) welcome.remove();

    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}`;
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';
    
    // For bot messages, parse markdown
    if (type === 'bot') {
        contentDiv.innerHTML = parseMarkdown(text);
    } else {
        contentDiv.textContent = text;
    }
    
    messageDiv.appendChild(contentDiv);
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (!message) return;

            if (isLoading) {
                addMessage('Please wait while the system is loading...', 'system');
                return;
            }

            if (!model) {
                addMessage('AI model is not initialized. Please check the API key.', 'system');
                return;
            }

            if (!knowledgeBase || !universitySummary) {
                addMessage('Knowledge base files are not loaded. Please check the file URLs in CONFIG.', 'system');
                return;
            }

            input.value = '';
            document.getElementById('sendBtn').disabled = true;

            addMessage(message, 'user');
            showTypingIndicator();

            try {
                const response = await queryGemini(message);
                removeTypingIndicator();
                addMessage(response, 'bot');
            } catch (error) {
                removeTypingIndicator();
                addMessage('Sorry, I encountered an error. Please try again.', 'system');
                console.error('Error:', error);
            }

            document.getElementById('sendBtn').disabled = false;
            input.focus();
        }

        async function queryGemini(userQuery) {
            const systemPrompt = `You are a helpful university assistant chatbot. Your role is to answer questions about the university using the provided knowledge base.

UNIVERSITY CONTEXT:
${universitySummary}

KNOWLEDGE BASE:
${knowledgeBase}

INSTRUCTIONS:
0. (Important) a) give response in structured markdown text, b) give proper indentaction and newline character c) and also add bullet points when needed
1. First, check if the answer is available in the KNOWLEDGE BASE above
2. If the information is in the knowledge base, use it to answer the question accurately
3. If the information is NOT in the knowledge base, use the UNIVERSITY CONTEXT to provide a relevant answer
4. Always maintain the context that you're answering about this specific university
5. Be friendly, professional, and concise
6. If you truly don't know something even with the context, politely say so and offer to help with something else
7. Try to give answers in bullet point or lists when needed, example: if user ask list of courses then answre in bullet points.
8. (priority) Try to answere in bullet points 
User Question: ${userQuery}

Please provide a helpful answer:`;

            try {
                const result = await model.generateContent(systemPrompt);
                const response = await result.response;
                const text = response.text();
                return text;
            } catch (error) {
                console.error('Gemini API Error:', error);
                throw new Error('Failed to get response from AI: ' + error.message);
            }
        }
    </script>
</body>
</html>